sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/core/CustomStyleClassSupport","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,o,t,n,r,s){"use strict";return e.extend("coffee-frontend.controller.Home",{onInit:function(){const e=this.getView();o.load({id:e.getId(),name:"coffee-frontend.view.fragment.NavigationBar",controller:this}).then(function(o){e.byId("navbarContainer").destroyContentLeft();e.byId("navbarContainer").addContentLeft(o)});this.refreshBalance()},refreshBalance:function(){const e=JSON.parse(localStorage.getItem("user"));if(!e||!e.userId){console.warn("No user logged in, cannot refresh balance.");return}const o=this.getView().getModel();o.read(`/User('${e.userId}')`,{success:e=>{const o=this.getView().getModel("balanceModel")||new s;o.setData({balance:e.balance});this.getView().setModel(o,"balanceModel");console.log(`Balance refreshed: €${e.balance}`)},error:e=>{console.error("Failed to refresh balance:",e);n.show("Could not refresh balance.")}})},onNavHome:function(){this.getOwnerComponent().getRouter().navTo("home")},onNavProfile:function(){this.getOwnerComponent().getRouter().navTo("profile")},onNavAdmin:function(){this.getOwnerComponent().getRouter().navTo("admin")},onSelectSingle:function(){n.show("Single selected")},onSelectDouble:function(){n.show("Double selected")},onTopUpBalance:function(){this.onOpenTopUpDialog()},onOpenTopUpDialog:function(){const e=this.getView();if(!this._pTopUpDialog){this._pTopUpDialog=o.load({id:e.getId(),name:"coffee-frontend.view.fragment.TopUp",controller:this}).then(function(o){e.addDependent(o);o.open();return o})}else{this._pTopUpDialog.then(function(e){e.open()})}},onCloseTopUpDialog:function(){if(this._pTopUpDialog){this._pTopUpDialog.then(function(e){e.close()})}},onOpenCheckoutDialog:function(){const e=this.getView();if(!this._pDialog){this._pDialog=o.load({id:e.getId(),name:"coffee-frontend.view.fragment.Checkout",controller:this}).then(function(o){e.addDependent(o);o.open();return o})}else{this._pDialog.then(function(e){e.open()})}},onCloseCheckoutDialog:function(){if(this._pDialog){this._pDialog.then(function(e){e.close()})}},onUseBalance:function(){const e=this.getView();const o=e.getModel();const t=JSON.parse(localStorage.getItem("user"));if(!t||!t.userId){r.error("User not logged in.");return}o.read("/Machine",{success:e=>{if(!e.results.length){r.error("No coffee machine found.");return}const s=e.results[0].machineId;o.callFunction("/Tap",{method:"POST",urlParameters:{userId:t.userId,machineId:s},success:()=>{n.show("Coffee ordered successfully!");this.onCloseCheckoutDialog();this.refreshBalance()},error:e=>{const o=e?.responseText||"Payment failed.";r.error(o)}})},error:()=>{r.error("Failed to fetch machine.")}})},onSelectTopUpAmount:function(e){const o=e.getSource().getParent();o.getItems().forEach(e=>e.removeStyleClass("selected"));e.getSource().addStyleClass("selected");const t=e.getSource().getText().replace("€","").trim();this._selectedAmount=parseFloat(t);n.show(`Selected €${this._selectedAmount}`)},onPayTopUp:function(){const e=this.getView();const o=e.getModel();const t=JSON.parse(localStorage.getItem("user"));if(!t||!t.userId){r.error("User not logged in.");return}if(!this._selectedAmount){r.error("Please select an amount first.");return}sap.ui.core.BusyIndicator.show(0);o.callFunction("/TopUp",{method:"POST",urlParameters:{userId:t.userId,amount:this._selectedAmount},success:e=>{sap.ui.core.BusyIndicator.hide();if(e&&typeof e==="string"){window.open(e,"_blank");n.show("Redirecting to PayPal...");this.refreshBalance()}else{r.warning("No PayPal URL returned.")}},error:e=>{sap.ui.core.BusyIndicator.hide();console.error(e);r.error("Top-up failed.")}})}})});
//# sourceMappingURL=Home.controller.js.map